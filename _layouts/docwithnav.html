{% include dochead.html %}
<div class="container-fluid">
	<div class="row">
		<div class="col-xs-1 hidden-md hidden-lg navbuttonarrow">
		<!-- Nav menu button for smaller (mobile) views-->
			<a href="javascript:;" class="togglenav">
				<img src="{{site.url}}/img/mobile/chevron-right.png" style="display:inline-block"/>
				<img src="{{site.url}}/img/mobile/chevron-left.png" style="display:none"/>
			</a>
		</div>
		<div class="gcse-wrapper" id="gcse-searchbox">
			<!-- Search box for Google Custom Search Engine -->
			<gcse:searchbox></gcse:searchbox>
		</div>
	</div>
	<div class="row">
		<!-- Navigation menu -->
		<div class="col-md-3 hidden-sm hidden-xs" id="wrapper">
			{% include nav_v1.0.html %}
		</div>
		<!-- Content body -->
		<div class="col-md-8 col-sm-11 col-xs-11 bodywrapper">
			{% include documentation.html %}
		</div>
	</div>
</div>
<div class="gcse-wrapper">
    <gcse:searchresults></gcse:searchresults>
</div>
<script type="text/javascript">
	$(function() {
		var menu_ul = $('.menu > li > ul');
		/* For the current URL, find the corresponding item in navigation menu */
		function findcurnavitem(){
			var noanchorhref = window.location.href.split('#')[0];
			var navitem = $('#wrapper a[href="' + noanchorhref + '"]');
			return navitem;
		}
		/* Open the navigation menu and highlight the menu item that corresponds to the current URL */
		function syncmenutourl(){
			var curnavitem = findcurnavitem();
			$('.menu a').removeClass('active');
			if(curnavitem.hasClass('hiddenlink')){//if its a hidden getting started topic, highlight the container
				curnavitem.parent().parent().parent().children('a.gentoc').addClass('active');
				menu_ul.not(curnavitem.parents('ul.hiddenlist')).slideUp('fast', function() {//exclude active menus and close all others
					curnavitem.parents('ul.hiddenlist').slideDown('fast', function() {
						scrolltonavitem();
					});
				});
			}else{//highlight the nav item and open the menu
				curnavitem.addClass('active');
				var navmenu = curnavitem;
				if(curnavitem.parent('li').hasClass('haschild')){//if its a container, find the submenu
					navmenu = curnavitem.next('ul');
					var activesubmenu = curnavitem.next('ul');
				}
				else {//if its a child, find it's menu
					navmenu = curnavitem.parent('li').parent('ul');
					var activemenu = curnavitem.parent('li').parent('ul.navSubMenu');
				}
				menu_ul.not(activemenu).not(activesubmenu).slideUp('fast', function() {//exclude active menus and close all others
					navmenu.slideDown('fast', function() {
						scrolltonavitem();
					});
				});
			}
			return;
		}
		syncmenutourl();
		/* Look for change in page state and load any changes */
		function loadonstatechange(){
		    $(window).bind('popstate', function (event) {
				var returnLocation = history.location || document.location;
				returnlochref = returnLocation.href;
				if ((returnlochref.indexOf('.yaml') > -1 && returnlochref.indexOf('.yaml') + 5 == returnlochref.length) || (returnlochref.indexOf('.json') > -1 && returnlochref.indexOf('.json') + 5 ==  returnlochref.length)) {//open code samples (.yaml or .json files) in <code> blocks
					$('#doccontent').load(location.origin + "/codeblockdisplay.html", function() {
						$('#codeblock').load(returnlochref, function() { //load the code sample file into the 'code' tags
							$('#codetitle').html(location.pathname); //set the page title
							$( "code" ).prepend( "<br />" ); //insert line break to correct unwanted 1st line indentation
						});
					});
				} else {
					$('#doccontent').load(returnLocation + ' #doccontent > *', function() {//load the content from the target page
						var navitem = findcurnavitem();
						if (navitem.hasClass('gentoc')) {//generate the dynamic TOC
							var tocid = String(navitem.parent().children('ul').attr('id'));//cast id to string
							$('#toclist').load( location.pathname + " #" + tocid + " li" );
						}
					});
				}
				syncmenutourl();
		       return;
		    });
		}
		loadonstatechange();
		/* Watch for any click in the content area and close the nav menu if its open (for small res. desiplays) */
		$('.bodywrapper').on("click", function(e) {
			if($('#wrapper').hasClass('col-sm-5')) {
				togglenavmenu();
			}
		});
		/* Handle clicks in nav menu, content body, and header. Also track history by pushing state (so back/forward browser buttons work)*/
	    $(document).on("click", 'a', function(e) {
	        e.preventDefault();
			var clickedon = $(this),
				href = $(this).attr('href'),
				isAnchor = false,
				hasAnchor = false,
				isCode = false;
			if (href.indexOf('#') == 0){//check if its an in-page anchor
				isAnchor = true;
			} else if(href != "#") {//otherwise get the absolute url
				href = this.href;
				if (href.indexOf('#') > 0) {//check for an anchor in the URL
					hasAnchor = true;
				}
			}
			//handle the type of click
			if(href == "javascript:;") {//clicks on javascript only elements
				if (clickedon.hasClass('togglenav')) { //toggle display of the nav menu (hidden by default on small res. displays)
					togglenavmenu();
					if (!($('#wrapper').hasClass('hidden-sm'))) {
						syncmenutourl();
					}
				}
				return false;
			} else {//clicks on all other elements
				//close nav menu on click but exclude container topics so the sub-topics get displayed (for small res. displays)
				if($('#wrapper').hasClass('col-sm-5') && !(clickedon.parent().hasClass('haschild'))) {
					togglenavmenu();
				}
				if(this.host != location.host) {//open external links in new tab/window
					window.open(href, '_blank');
				} else if(href != "#" && !clickedon.parents('header').is('#nav') && !clickedon.parents('div').is('#mobile-nav-container')) {//skip empty nav menu containers and any clicks in the banner and banner menu
					//track all history but exclude clicks that only toggle open/closed container menus
					if (!(clickedon.hasClass('active') && clickedon.parent('li').hasClass('haschild'))) {
						history.pushState(null, null, href);
					}
					if(isAnchor){//if an in-page anchors, scroll to it
						var offset = 0;
						if ($(href).length) {//make sure its not an empty anchor, otherwise start at the top (offset = 0)
							offset = $(href).offset().top - 155;
						}
						$('html, body').animate({scrollTop: offset}, 0);//scroll to anchor
					} else if ((href.indexOf('.yaml') > -1 && href.indexOf('.yaml') + 5 == href.length) || (href.indexOf('.json') > -1 && href.indexOf('.json') + 5 ==  href.length)) {//open code samples (.yaml or .json files) in <code> blocks
						$('#doccontent').load(location.origin + "/codeblockdisplay.html", function() {
							$('#codeblock').load(href, function() {	//load the code sample file into the 'code' tags
								$('#codetitle').html(location.pathname); //set the page title
								$( "code" ).prepend( "<br />" ); //insert line break to correct unwanted 1st line indentation
							});
						});
						isCode = true;
					} else { //if its a link to another topic, only load content into the page (avoid refreshing whole page)
						$('#doccontent').load(href + ' #doccontent > *', function() {//load the content from the target page
							if (clickedon.hasClass('gentoc')) {//generate the dynamic TOC
								var tocid = String(clickedon.parent().children('ul').attr('id'));//cast id to string
								$('#toclist').load( location.pathname + " #" + tocid + " li" );
							}
							var offset = 0;//set offset to the top of the page
							if (hasAnchor) {//if URL has an anchor, find and set its offset
								var hash = "#" + href.substring(href.indexOf("#")+1);//retrieve only the anchor from the URL
								if ($(hash).length) {//make sure its not an empty anchor
									offset = $(hash).offset().top - 155;
								}
							}
							$('html, body').animate({scrollTop: offset}, 0);
						});
						$.get(href, function(html){//update the page's <title> tags with title from loaded page (so browser shows current title)
						    var matches = html.match(/<title>([^<]*)/);
						    if (matches.length>0) {
						        var title = matches[1];
						        document.title = title;
						    }
						});
					}
					if(!isCode){//dont change/animate nav menu when dispalying a code sample
						if(clickedon.parents().hasClass('bodywrapper')){//animate navigation menu
							animatenav(findcurnavitem());//is an in-page link
						} else {
							animatenav(clickedon);//is a nav menu link
						}
					}
				} else if (href != "#"){ //if its a link in the main menu, load and refresh the whole page
					window.location = href;
				}
			}
		    return false; // don't actually follow the link (avoid reloading page (default browser click behavior))
	    });
		/* Animate navigation menu to open/close sub menus and then highlight the target/active navigation menu item */
		function animatenav(anhref){
			var ishidden = false;
			//if target is a hidden getting started topic, then highlight and open the container
			if(anhref.hasClass('hiddenlink')){//is an in-page link
				anhref = anhref.parent().parent().parent().children('a.gentoc');//set focus to container
				ishidden = true;
			} else if(anhref.hasClass('gentoc') && anhref.parent().parent().hasClass('hiddenlist')) {//is a nav menu link
				ishidden = true;
			}
			//close inactive menu and open the related menu
			if(!anhref.hasClass('active')) {
				//close open menu if its not within the target's menu
				if(anhref.parents('li.haschild').length === 0 || anhref.parents('li').find('a.active').length === 0){
					menu_ul.filter(':visible').slideUp('fast');
				}
				$('.menu a').removeClass('active');//clear active items
				//set the target active and ensure target's menu is open
				if(ishidden) {//is a hidden getting started container
					anhref.addClass('active');
					scrolltonavitem();
				} else if (anhref.next('ul').length === 0){//is a child nav item, open menu
					anhref.addClass('active').closest('ul').slideDown('fast', function() {
						scrolltonavitem();
					});
				} else {//is a container nav item, open menu
					anhref.addClass('active').next().stop(true,true).slideDown('fast', function() {
						scrolltonavitem();
					});
				}
			//toggle the menu open/close if the target is a container
			} else if (anhref.hasClass('active') && anhref.parent('li').hasClass('haschild')) {
				anhref.next().stop(true,true).toggle('fast');
			}
		}
		/* Scroll to navigation item if its offscreen */
		function scrolltonavitem(){
			var curnavitem = findcurnavitem();
			if(curnavitem.hasClass('hiddenlink')){//if its a hidden getting started topic, select the parent container
				curnavitem = curnavitem.parent().parent().parent().children('a.gentoc');
			}
			var itemposition = curnavitem.position().top, //item's location relative to visible navigation menu
				visible_start = $('#wrapper').scrollTop(), //location at top of visible navigation menu
				total_visible = $('#wrapper').innerHeight(), //total height of visible navigation menu
				visible_end = visible_start + total_visible; //location at bottom of visible window
		    if(itemposition < 0 || itemposition > total_visible){// check if its outside visible area and then move it
				$('#wrapper').animate({
					scrollTop: (visible_start + itemposition - 155) // move to visible area and add padding to account for banner
					}, 50);
			}
	        return false;
		}
		/* Toggle the navigation menu open or closed (for small resolution screens) */
		function togglenavmenu() {
			$('#wrapper').toggleClass('hidden-sm hidden-xs col-sm-5 col-xs-7');
			$('.togglenav').find('img').toggle();
		}
	});
</script>
{% include docfooter.html %}
