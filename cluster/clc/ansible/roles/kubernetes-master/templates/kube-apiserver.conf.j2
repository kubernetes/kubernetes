description "kube-apiserver service"
author "mark ramach"

script

	KUBE_APISERVER_OPTS="\
		--address=0.0.0.0 \
		--admission_control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota \
		--advertise-address={{ ansible_default_ipv4.address }} \
		--allow-privileged=true \
		--basic-auth-file=/srv/kubernetes/password \
		--client-ca-file=/srv/kubernetes/ca.crt \
		--etcd-servers={{ etcd_endpoint }} \
		--insecure-bind-address=0.0.0.0 \
		--insecure-port=8080 \
		--runtime-config=extensions/v1beta1/daemonsets=true \
		--service-account-key-file=/srv/kubernetes/server.key \
		--service-cluster-ip-range={{ cluster_service_vip_range }} \
		--tls-cert-file=/srv/kubernetes/server.crt \
		--tls-private-key-file=/srv/kubernetes/server.key \
		--token-auth-file=/srv/kubernetes/known_tokens.csv \
    "

	exec kube-apiserver $KUBE_APISERVER_OPTS > /var/log/kube-apiserver.log

end script
